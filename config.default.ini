[DEFAULT]

; ========================================================
; dbus-aggregate-smartshunts Default Configuration
; ========================================================
; 
; DO NOT EDIT THIS FILE!
; 
; Copy settings you want to change to config.ini
; The config.ini file will override these defaults
; ========================================================
;
; QUICK START GUIDE - What to Configure
; ========================================================
; 
; MUST CONFIGURE (copy to config.ini):
;   (Nothing! By default acts as SmartShunt monitor, auto-detects capacity)
;
; RECOMMENDED TO REVIEW:
;   • DEVICE_NAME           - Custom name for how it appears in Venus OS
;   • TOTAL_CAPACITY        - Leave empty for auto-detection, or set manually
;   • TEMP_COLD_DANGER      - Adjust for your battery chemistry (LiFePO4: 5°C, Lead: 0°C)
;   • TEMP_HOT_DANGER       - Adjust for your battery chemistry (LiFePO4: 45°C, Lead: 40°C)
;   • EXCLUDE_SHUNTS        - Leave empty to include all SmartShunts, or exclude specific ones
;
; EXPERIMENTAL (⚠️ Charge Control - use with caution):
;   • MAX_CHARGE_VOLTAGE    - Charge Voltage Limit (CVL) that DVCC enforces
;   • MAX_CHARGE_CURRENT    - Combined Charge Current Limit (CCL) that DVCC enforces
;   • MAX_DISCHARGE_CURRENT - Combined Discharge Current Limit (DCL) that DVCC enforces
;   (⚠️ Only set these if you need charge control and understand the risks)
;   (DVCC reads these from the aggregate and applies them to all Multi/Quattro/MPPT devices)
;
; USUALLY FINE AT DEFAULTS:
;   • TEMP_COLD_DANGER / TEMP_HOT_DANGER - Temperature thresholds for smart reporting
;   • Update intervals (device discovery backoff is automatic)
;   • Error handling (SEARCH_TRIALS, READ_TRIALS, TIME_BEFORE_RESTART)
;   • Logging settings
;
; Note: Voltage alarms (low/high) are automatically passed through from SmartShunts.
;       Configure voltage alarm thresholds in VictronConnect for each SmartShunt.
;
; ========================================================

; ----- Device Configuration -----
; Custom name for the aggregate device (how it appears in Venus OS)
; Leave empty for default "SmartShunt Aggregate"
; Example: DEVICE_NAME = Battery Bank
; Example: DEVICE_NAME = House Batteries
DEVICE_NAME = 

; ----- SmartShunt Configuration -----
; Exclude specific SmartShunts from aggregation (leave empty to include ALL)
; By default, all SmartShunts found on D-Bus are included.
; Use this to exclude specific shunts (e.g. a DC load shunt you don't want included)
; Can be a list of device instance IDs or custom names
; Examples:
;   EXCLUDE_SHUNTS =                                    (empty = include all)
;   EXCLUDE_SHUNTS = 279                                (exclude by instance ID)
;   EXCLUDE_SHUNTS = "DC Loads", "Aux Battery"          (exclude by custom name)
;   EXCLUDE_SHUNTS = 279, "DC Loads"                    (mixed)
EXCLUDE_SHUNTS = 

; ----- Battery Specifications -----
; Total capacity of all batteries combined (Ah)
; Leave empty for auto-detection (calculates from SmartShunt SoC and ConsumedAmphours)
; Or specify manually to match the sum of capacities configured in VictronConnect
; Example: TOTAL_CAPACITY = 600  (for 2x 300Ah batteries)
; Note: Auto-detection can use two methods - see CAPACITY_MODE below
TOTAL_CAPACITY = 

; ----- Capacity Detection Mode -----
; CAPACITY_MODE: How to auto-detect capacity when TOTAL_CAPACITY is not set
;   register = Read from SmartShunt config register 0x1000 (recommended)
;              Simple and reliable - uses the capacity configured in each SmartShunt
;   soc      = Calculate from SoC and ConsumedAmphours (advanced)
;              Requires SoC between 10-90%, may be more accurate for aged batteries
CAPACITY_MODE = register

; ----- Device Mode -----
; DEVICE_MODE: How the aggregate presents itself and what control it provides
;
; Options:
;   monitor          - Pure SmartShunt monitor (ProductId 0xA389)
;                      • Reports voltage, current, SoC, temperature
;                      • Does NOT publish charge limits (CVL/CCL/DCL)
;                      • Does NOT control charging/discharging  
;                      • Use when: You have other charge control (Multi, MPPT settings, etc.)
;
;   virtual-bms      - Virtual BMS device (ProductId 0xBA77)
;                      • Reports voltage, current, SoC, temperature
;                      • Publishes CVL/CCL/DCL for DVCC (requires config below)
;                      • Dynamically enables/disables charge/discharge based on alarms
;                      • Appears as "BMS" in Venus OS UI
;                      • ⚠️ EXPERIMENTAL - use with caution, monitor closely!
;                      • Use when: You want the aggregate to control charging system-wide
;
; Default: monitor (safe - no charge control)
DEVICE_MODE = monitor

; ----- Charge/Discharge Limits -----
; ⚠️ ONLY USED IF DEVICE_MODE = virtual-bms ⚠️
; ⚠️  EXPERIMENTAL: Virtual BMS Mode ⚠️
; 
; If you set these values, the aggregate will publish charge control limits that
; DVCC uses to control your entire Victron system.
;
; ⚠️  EXPERIMENTAL FEATURE - USE WITH CAUTION ⚠️
; This feature allows the aggregate SmartShunt to provide charge control limits
; (like a BMS would). While it follows Victron's standard D-Bus protocol, it has
; NOT been extensively tested in all configurations.
;
; If you enable this feature:
; 1. Monitor your system closely for the first few charge/discharge cycles
; 2. Verify DVCC is correctly applying the limits
; 3. Ensure your battery's internal BMS (if present) provides backup protection
; 4. Please report your experience (success or issues) on the GitHub project
;
; When configured, this publishes:
;   - /Info/MaxChargeVoltage (CVL) - if set
;   - /Info/MaxChargeCurrent (CCL) - if set
;   - /Info/MaxDischargeCurrent (DCL) - if set
;   - /Io/AllowToCharge - dynamically set based on conditions:
;       * Disabled if high voltage alarm active
;       * Disabled if high temperature alarm active
;       * Disabled if temperature exceeds TEMP_HOT_DANGER
;   - /Io/AllowToDischarge - dynamically set based on conditions:
;       * Disabled if low voltage alarm active
;       * Disabled if low SoC alarm active
;       * Disabled if low temperature alarm active
;       * Disabled if temperature below TEMP_COLD_DANGER
;
; This provides multi-layer protection:
;   1. SmartShunts detect and alarm on voltage/SoC/temp issues
;   2. Aggregate automatically disables charge/discharge when alarms trigger
;   3. Your battery's internal BMS provides final hardware protection
;
; IMPORTANT: These are COMBINED/TOTAL values for ALL batteries in parallel
; Example: 2x 300Ah batteries, each with 150A charge / 300A discharge limits
;   → MAX_CHARGE_CURRENT = 300  (150A + 150A)
;   → MAX_DISCHARGE_CURRENT = 600  (300A + 300A)

; Maximum charging voltage (V)
; This is the voltage for the entire parallel bank (same for all batteries)
; Required if DEVICE_MODE = virtual-bms
; Example: MAX_CHARGE_VOLTAGE = 14.6  (LiFePO4: 3.65V per cell for 4S)
; Example: MAX_CHARGE_VOLTAGE = 14.4  (Lead-acid)
MAX_CHARGE_VOLTAGE = 

; Maximum combined charge current (A)
; This is the TOTAL/SUM for ALL batteries in parallel
; Required if DEVICE_MODE = virtual-bms
; Example: MAX_CHARGE_CURRENT = 300  (2x 300Ah @ 0.5C = 150A + 150A)
MAX_CHARGE_CURRENT = 

; Maximum combined discharge current (A)
; This is the TOTAL/SUM for ALL batteries in parallel
; Required if DEVICE_MODE = virtual-bms
; Example: MAX_DISCHARGE_CURRENT = 600  (2x 300Ah @ 1C = 300A + 300A)
MAX_DISCHARGE_CURRENT = 

; Note: All alarm thresholds (voltage, SoC, temperature) are configured in VictronConnect
; for each individual SmartShunt and automatically passed through by the aggregate service.

; ----- Temperature Monitoring -----
; Temperature thresholds for smart reporting algorithm
; The aggregate temperature reading (/Dc/0/Temperature) will report:
;   - AVERAGE of all battery temps when all are in safe range
;   - MINIMUM (coldest) temp across all batteries when any drops below TEMP_COLD_DANGER
;   - MAXIMUM (hottest) temp across all batteries when any rises above TEMP_HOT_DANGER
;   - MOST CRITICAL temp when both cold and hot dangers are present
;
; This ensures the system sees the most dangerous temperature condition for cell protection.
;
; LiFePO4 safe charging range: 0°C to 45°C (32°F to 113°F)
; LiFePO4 safe discharging range: -20°C to 60°C (-4°F to 140°F)

; Cold danger threshold (°C)
; When any battery temp drops below this value, the aggregate will report the MINIMUM 
; (coldest) temperature across all batteries instead of the average.
; Below 0°C: Cannot charge (lithium plating causes permanent damage)
; Recommended: 5°C (41°F) for early warning before reaching critical 0°C
TEMP_COLD_DANGER = 5.0

; Hot danger threshold (°C)
; When any battery temp rises above this value, the aggregate will report the MAXIMUM
; (hottest) temperature across all batteries instead of the average.
; Above 45°C: Charging causes chemical stress and accelerated aging
; Above 60°C: Risk of thermal issues even during discharge
; Recommended: 45°C (113°F) for LiFePO4, 40°C (104°F) for lead-acid
TEMP_HOT_DANGER = 45.0

; ----- Update Intervals -----
; Initial interval for searching for SmartShunts at startup (seconds)
; After devices are found and stable for 30 seconds, the interval increases
; using exponential backoff (doubles each cycle) up to MAX_UPDATE_INTERVAL_FIND_DEVICES
; This reduces D-Bus overhead once the system is stable
UPDATE_INTERVAL_FIND_DEVICES = 1

; Maximum interval for searching for SmartShunts after exponential backoff (seconds)
; Default: 1800 seconds (30 minutes)
; When a new device is detected, the interval resets to UPDATE_INTERVAL_FIND_DEVICES
MAX_UPDATE_INTERVAL_FIND_DEVICES = 1800

; Note: Data aggregation updates happen REACTIVELY (immediately when physical shunts change)
; rather than on a polling interval. This provides real-time updates with minimal D-Bus overhead.

; ----- Error Handling -----
; Number of search trials before giving up
SEARCH_TRIALS = 10

; Number of read errors before restart
READ_TRIALS = 10

; Time to wait before restart after fatal error (seconds)
TIME_BEFORE_RESTART = 15

; ----- Logging -----
; Logging level: DEBUG, INFO, WARNING, ERROR
LOGGING = INFO

; Periodic status logging interval (seconds, 0 = disabled)
LOG_PERIOD = 300

; ========================================================
; EXAMPLE config.ini - Copy and customize this section
; ========================================================
;
; Create a file named "config.ini" in the same directory with:
;
; [DEFAULT]
; 
; ; Optional: Capacity (leave empty for auto-detection)
; ; TOTAL_CAPACITY = 600
;
; ; Optional: Virtual BMS mode - set charge/discharge limits
; ; (Only if you have batteries with inaccessible BMS and not using DVCC)
; ; MAX_CHARGE_VOLTAGE = 14.6
; ; MAX_CHARGE_CURRENT = 300
; ; MAX_DISCHARGE_CURRENT = 600
;
; ; Optional: Exclude specific SmartShunts (e.g. DC loads shunt)
; ; EXCLUDE_SHUNTS = 279
; ; EXCLUDE_SHUNTS = "DC Loads", "Aux Battery"
;
; ========================================================
